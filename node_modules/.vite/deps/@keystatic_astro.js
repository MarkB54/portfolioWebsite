import {
  __commonJS,
  __toESM
} from "./chunk-SNAQBZPT.js";

// browser-external:node:fs
var require_node_fs = __commonJS({
  "browser-external:node:fs"(exports, module) {
    module.exports = Object.create(new Proxy({}, {
      get(_, key) {
        if (key !== "__esModule" && key !== "__proto__" && key !== "constructor" && key !== "splice") {
          console.warn(`Module "node:fs" has been externalized for browser compatibility. Cannot access "node:fs.${key}" in client code. See https://vite.dev/guide/troubleshooting.html#module-externalized-for-browser-compatibility for more details.`);
        }
      }
    }));
  }
});

// node_modules/@keystatic/astro/dist/keystatic-astro.js
var import_node_fs = __toESM(require_node_fs());
function keystatic() {
  return {
    name: "keystatic",
    hooks: {
      "astro:config:setup": ({
        injectRoute,
        updateConfig,
        config
      }) => {
        updateConfig({
          server: config.server.host ? {} : {
            host: "127.0.0.1"
          },
          vite: {
            plugins: [{
              name: "keystatic",
              resolveId(id) {
                if (id === "virtual:keystatic-config") {
                  return this.resolve("./keystatic.config", "./a");
                }
                return null;
              }
            }],
            optimizeDeps: {
              entries: ["keystatic.config.*", ".astro/keystatic-imports.js"]
            }
          }
        });
        const dotAstroDir = new URL("./.astro/", config.root);
        (0, import_node_fs.mkdirSync)(dotAstroDir, {
          recursive: true
        });
        (0, import_node_fs.writeFileSync)(new URL("keystatic-imports.js", dotAstroDir), `import "@keystatic/astro/ui";
import "@keystatic/astro/api";
import "@keystatic/core/ui";
`);
        injectRoute({
          // @ts-ignore
          entryPoint: "@keystatic/astro/internal/keystatic-astro-page.astro",
          entrypoint: "@keystatic/astro/internal/keystatic-astro-page.astro",
          pattern: "/keystatic/[...params]",
          prerender: false
        });
        injectRoute({
          // @ts-ignore
          entryPoint: "@keystatic/astro/internal/keystatic-api.js",
          entrypoint: "@keystatic/astro/internal/keystatic-api.js",
          pattern: "/api/keystatic/[...params]",
          prerender: false
        });
      }
    }
  };
}
export {
  keystatic as default
};
//# sourceMappingURL=@keystatic_astro.js.map
