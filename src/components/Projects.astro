---
import { getCollection } from "astro:content";
import ProjectCard from "./ProjectCard.astro";

const projectEntries = await getCollection("projects");

// Sort: ongoing first (no endDate), then by end date descending (most recent first)
const sortedProjects = projectEntries.sort((a, b) => {
  const aEnd = a.data.endDate?.getTime() ?? Infinity;
  const bEnd = b.data.endDate?.getTime() ?? Infinity;
  if (aEnd !== bEnd) return bEnd - aEnd;
  return b.data.startDate.getTime() - a.data.startDate.getTime();
});
---

<section id="projects" class="py-20 px-4 bg-base-200">
  <div class="max-w-6xl mx-auto">
    <div class="text-center mb-12">
      <h2 class="text-3xl md:text-4xl font-bold mb-4">Projects</h2>
      <p class="text-lg text-base-content/70 max-w-2xl mx-auto">
        A selection of projects I've built, showcasing full-stack development
        and modern web technologies.
      </p>
    </div>

    {
      sortedProjects.length === 0 ? (
        <div class="text-center py-12">
          <p class="text-lg text-base-content/60">
            No projects yet. Check back soon.
          </p>
        </div>
      ) : (
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 max-w-4xl mx-auto">
          {sortedProjects.map((project) => (
            <ProjectCard project={project} />
          ))}
        </div>
      )
    }
  </div>
</section>
